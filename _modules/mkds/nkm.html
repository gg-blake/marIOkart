<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>mkds.nkm - MarI/O Kart documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">MarI/O Kart  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">MarI/O Kart  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/articles/articles.html">Research Articles</a><input aria-label="Toggle navigation of Research Articles" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/articles/OVERLAYS.html">MKDS Overlay System — Extensible Overlays for Mario Kart DS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/articles/READING_MEMORY.html">MKDS Emulator I/O &amp; Geometry Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/articles/READING_FILES.html"><code class="docutils literal notranslate"><span class="pre">mkds</span></code> — Mario Kart DS NKM &amp; KCL Readers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/src.core.html">src.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/src.mkds_extensions.html">src.mkds_extensions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/src.utils.html">src.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/src.visualization.html">src.visualization package</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/mkds.html">MKDS File Parsing Library</a><input aria-label="Toggle navigation of MKDS File Parsing Library" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/mkds/nkm.html">mkds.nkm module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mkds/kcl.html">mkds.kcl module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mkds/utils.html">mkds.utils module</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for mkds.nkm</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">read_u8</span><span class="p">,</span>
    <span class="n">read_u16</span><span class="p">,</span>
    <span class="n">read_u32</span><span class="p">,</span>
    <span class="n">read_s16</span><span class="p">,</span>
    <span class="n">read_s32</span><span class="p">,</span>
    <span class="n">read_fx16</span><span class="p">,</span>
    <span class="n">read_fx32</span><span class="p">,</span>
    <span class="n">read_vector_2d_fx32</span><span class="p">,</span>
    <span class="n">read_vector_3d_fx32</span>
<span class="p">)</span>


<div class="viewcode-block" id="Section">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.Section">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Section</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for sections in an NKM file.</span>
<span class="sd">    </span>
<span class="sd">    Overview</span>
<span class="sd">    ========</span>
<span class="sd">    Most NKM sections (all except STAG) begin with an 8-byte section header:</span>
<span class="sd">      - 0x00 (4 bytes): Section magic (ASCII, e.g., &quot;OBJI&quot;).</span>
<span class="sd">      - 0x04 (4 bytes): Number of entries in the section (UInt32).</span>
<span class="sd">    Immediately after the header the section contains `entry_count` entries,</span>
<span class="sd">    each with a fixed stride (size) which is specified by the concrete Section</span>
<span class="sd">    subclass.</span>

<span class="sd">    This base class encapsulates:</span>
<span class="sd">      - raw `data` for the whole section (header + entries)</span>
<span class="sd">      - `stride` (size in bytes of a single entry)</span>
<span class="sd">      - `entry_count` parsed from the header</span>
<span class="sd">      - an iterator over each fixed-size entry slice</span>

<span class="sd">    Notes / Caveats</span>
<span class="sd">    ----------------</span>
<span class="sd">    * This class assumes the `data` passed includes the section header.</span>
<span class="sd">    * If a section contains variable-length entries (rare in NKM), a custom</span>
<span class="sd">      parser should be used instead of relying on a fixed stride.</span>
<span class="sd">    * Many sections have fields where 0xFFFF or 0xFF indicates &quot;unused&quot; or</span>
<span class="sd">      &quot;none&quot; — callers should treat those sentinel values accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x08</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">size</span>
        <span class="c1"># Number of entries (UInt32 at offset 0x04 of the section header).</span>
        <span class="c1"># If `data` is not the whole section starting with the header, this</span>
        <span class="c1"># will be incorrect — ensure `data` includes the 8-byte section header.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_count</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_count</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">]</span></div>



<div class="viewcode-block" id="OBJI">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.OBJI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">OBJI</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OBJI — Object Instances section.</span>

<span class="sd">    Stride: 0x3C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Describes every object placed in the track: visual decorations, interactive</span>
<span class="sd">    objects, obstacle instances, item boxes, etc. These objects are instantiated</span>
<span class="sd">    by the game engine and can be linked to PATH routes.</span>


<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-obji:</span>
<span class="sd">      :end-before: .. _nkm-table-path:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - The object ID decides both model and in some cases runtime logic (collision,</span>
<span class="sd">      activatable behaviors).</span>
<span class="sd">    - The route_id links the object to a PATH. If present, the object will be</span>
<span class="sd">      moved/animated by the PATH&#39;s POIT points at runtime (e.g., moving platforms,</span>
<span class="sd">      cameras).</span>
<span class="sd">    - The object settings are used by many object types to control behavior:</span>
<span class="sd">      rotation speed, spawn flags, timers, random seeds, or other per-object</span>
<span class="sd">      parameters. Different object IDs require different decoding logic.</span>

<span class="sd">    Reverse-Engineering Notes / Tips</span>
<span class="sd">    --------------------------------</span>
<span class="sd">    - The four 32-bit settings differ radically between object types — community</span>
<span class="sd">      wikis often contain per-object decode rules (use object ID to branch).</span>
<span class="sd">    - The presence of a non-0 or non-0xFFFFFFFF route_id often means the object</span>
<span class="sd">      will be animated along that route; route indices are bytes in PATH entries</span>
<span class="sd">      but stored here as a 16-bit value (keep an eye on sign/width).</span>
<span class="sd">    - Show-in-time-trials: historically some editors used 0/1 inverse; verify</span>
<span class="sd">      against known tracks when in doubt.</span>

<span class="sd">    Parsing Caveat</span>
<span class="sd">    --------------</span>
<span class="sd">    We read `object_id` as `read_u16` and `route_id` as `read_u16`. Consumers of</span>
<span class="sd">    this class should treat 0xFFFF in `route_id` as &quot;no route&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">route_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_settings</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">)]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_in_time_trials</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="PATH">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.PATH">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PATH</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PATH — Path metadata.</span>

<span class="sd">    Stride: 0x04 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Describes metadata for routes used by objects and cameras. Each PATH entry</span>
<span class="sd">    points to a sequence of POIT entries (control points) that define the route.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-path:</span>
<span class="sd">      :end-before: .. _nkm-table-poit:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Objects or cameras that reference a route will move along the POIT points</span>
<span class="sd">      in order; if the loop flag is set, the route repeats.</span>
<span class="sd">    - Route ID is commonly a small integer; the PATH list enumerates all routes</span>
<span class="sd">      in use on the track.</span>

<span class="sd">    Reverse-Engineering Notes / Caveats</span>
<span class="sd">    -----------------------------------</span>
<span class="sd">    * The canonical spec states: 0x01 == 1 if the route loops, 0 otherwise.</span>
<span class="sd">      In the code you originally used `read_u8(d, 0x01) != 1` (which inverts</span>
<span class="sd">      the meaning). I have NOT altered your logic — but be aware of the</span>
<span class="sd">      discrepancy: callers should expect `True` when the route loops.</span>
<span class="sd">      Consider changing to `read_u8(... ) == 1` for clarity.</span>
<span class="sd">    * `point_count` enumerates POIT entries but the mapping from global POIT</span>
<span class="sd">      index to route is (index offset + length) — consumers should reconstruct</span>
<span class="sd">      the actual POIT index ranges using CPAT/EPAT/IPAT/MEPA grouping sections</span>
<span class="sd">      when applicable (these groupings partition points).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">route_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="c1"># Warning: original code used inverted logic. The spec: 1 means loop.</span>
        <span class="c1"># We preserve original behavior here; consider flipping if you want literal.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="POIT">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.POIT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">POIT</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    POIT — Path points (control points).</span>

<span class="sd">    Stride: 0x14 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Stores the actual 3D points used by PATH routes. Points are grouped by route</span>
<span class="sd">    using the counts stored in PATH plus the various *PAT grouping sections.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-poit:</span>
<span class="sd">      :end-before: .. _nkm-table-stag:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Moving objects and cameras read these points sequentially to interpolate</span>
<span class="sd">      positions. The &quot;point_index&quot; normally indicates position in the route&#39;s</span>
<span class="sd">      ordering (0,1,2,...).</span>
<span class="sd">    - Some cameras or scripted objects use `point_duration` to wait between</span>
<span class="sd">      points, enabling non-linear motion.</span>
<span class="sd">    - POIT order in the file is important: group membership is often determined</span>
<span class="sd">      by successive ranges; use PAT sections to map ranges to specific routes.</span>

<span class="sd">    Reverse-Engineering Notes</span>
<span class="sd">    -------------------------</span>
<span class="sd">    - The unknown fields often show consistent patterns per track editor —</span>
<span class="sd">      check community resources to decode them for special behaviors.</span>
<span class="sd">    - Some older track versions or beta files encode rotation differently; when</span>
<span class="sd">      in doubt, cross-check with KTPJ notes for version-dependent behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_s16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="STAG">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.STAG">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">STAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    STAG — Stage (track) information.</span>

<span class="sd">    Fixed-size: The STAG section is unique in NKM: it does NOT have a section</span>
<span class="sd">    header and is a single 0x2C-byte structure placed directly in the file</span>
<span class="sd">    (after POIT in the canonical header ordering).</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Contains global track settings: track ID, default lap count, fog settings,</span>
<span class="sd">    colors used by KCL (collision visual palettes), and other miscellaneous bytes.</span>
<span class="sd">    </span>
<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-stag:</span>
<span class="sd">      :end-before: .. _nkm-table-ktps:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Amount of laps controls how many laps the race uses by default for the</span>
<span class="sd">      stage; some tracks use lap_count = 0 for special cases (verify per track).</span>
<span class="sd">    - Fog parameters influence rendering: enabling fog can hide distant objects</span>
<span class="sd">      and alter perceived depth; fog color &amp; distance control atmosphere.</span>
<span class="sd">    - KCL colors are the default palette for collision visualization (useful</span>
<span class="sd">      for editors and collision debugging).</span>

<span class="sd">    Implementation Notes</span>
<span class="sd">    --------------------</span>
<span class="sd">    * This class sets placeholders for color fields (GXRgb) — you can implement</span>
<span class="sd">      `GXRgb` decoding (usually 2 bytes per color or platform-specific) and</span>
<span class="sd">      populate these fields for richer output.</span>
<span class="sd">    * The unknown arrays are repeated in code (unknown2 and unknown3) — that</span>
<span class="sd">      mirrors the spec layout but may be redundant; keep one copy or rename for</span>
<span class="sd">      clarity if desired.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_id</span> <span class="o">=</span> <span class="n">read_u16</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amt_of_laps</span> <span class="o">=</span> <span class="n">read_u16</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown1</span> <span class="o">=</span> <span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_enabled</span> <span class="o">=</span> <span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_table_generation_mode</span> <span class="o">=</span> <span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_slope</span> <span class="o">=</span> <span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_distance</span> <span class="o">=</span> <span class="n">read_fx32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_color</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: Implement GXRgb parsing &amp; set this.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog_alpha</span> <span class="o">=</span> <span class="n">read_u16</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcl_color1</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: Implement GXRgb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcl_color2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcl_color3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcl_color4</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown3</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span></div>



<div class="viewcode-block" id="KTPS">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.KTPS">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KTPS</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KTPS — Kart/Start Positions (Start points for racers).</span>

<span class="sd">    Stride: 0x1C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines start positions (spawn/starting grid) for players/racers. Typically</span>
<span class="sd">    used for the main race starts; can also be used in battle or mission modes.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ktps:</span>
<span class="sd">      :end-before: .. _nkm-table-ktpj:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - On race start, the game picks starting positions from this section.</span>
<span class="sd">    - `start_position_index` is relevant for battle stages or mission mode where</span>
<span class="sd">      start ordering differs from main racing.</span>
<span class="sd">    - The rotation vector might be stored differently in beta versions — the</span>
<span class="sd">      canonical community notes indicate the Y-rotation sometimes needs to be</span>
<span class="sd">      computed via Atan2 on rotation vector components for older versions.</span>

<span class="sd">    Notes / Community Tips</span>
<span class="sd">    ----------------------</span>
<span class="sd">    - Typically the number of KTPS entries equals the number of players or more</span>
<span class="sd">      (some tracks list more possible starts than vehicles).</span>
<span class="sd">    - If you want to reposition start locations, modify positions and write the</span>
<span class="sd">      file back in FX32 format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_position_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="KTPJ">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.KTPJ">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KTPJ</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KTPJ — Respawn positions (kart respawn).</span>

<span class="sd">    Stride: 0x20 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Positions to which a kart (player) can respawn after falling off or during</span>
<span class="sd">    certain scripted events. Contains references to enemy/item points (EPOI/IPOI)</span>
<span class="sd">    to determine nearby behavior or AI context.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ktpj:</span>
<span class="sd">      :end-before: .. _nkm-table-ktp2:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - When a kart falls off the track or hits a severe collision, the engine</span>
<span class="sd">      picks a KTPJ respawn that matches the current lap and nearby conditions.</span>
<span class="sd">    - The enemy/item IDs let respawn logic pick nearby AI/item spawn points for</span>
<span class="sd">      smoother reintroduction.</span>

<span class="sd">    Version Notes</span>
<span class="sd">    -------------</span>
<span class="sd">    - For version 0x1E (older beta), the final Respawn ID (0x1C) may not exist.</span>
<span class="sd">    - The rotation encoding changed for early beta versions; if reading older</span>
<span class="sd">      tracks, compute Y-rotation via atan2(Rx, Rz) to convert to degrees.</span>

<span class="sd">    Remarks for Parser</span>
<span class="sd">    ------------------</span>
<span class="sd">    * We read `respawn_id` as a 32-bit value; if parsing older tracks that omit</span>
<span class="sd">      it, ensure you guard read beyond section length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enemy_position_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>  <span class="c1"># EPOI reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_position_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>   <span class="c1"># IPOI reference</span>
        <span class="c1"># Respawn ID may not exist in very old versions; this read assumes it does.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">respawn_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="KTP2">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.KTP2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KTP2</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KTP2 — Lap checkpoints (points to pass to count lap progress).</span>

<span class="sd">    Stride: 0x1C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines the &quot;lap gate&quot; points that the engine checks to determine whether a</span>
<span class="sd">    player completed a lap. Usually combined with timing/ordering checks.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ktp2:</span>
<span class="sd">      :end-before: .. _nkm-table-ktpc:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - The race logic queries these points as canonical lap markers.</span>
<span class="sd">    - Often unused fields are set to 0xFFFF; do not treat them as valid indices.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The &quot;Index&quot; is usually unused (set to 0xFFFF); if present, it may</span>
<span class="sd">      participate in specialized lap logic or developer tools.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="KTPC">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.KTPC">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KTPC</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KTPC — Cannon / Pipe destination points.</span>

<span class="sd">    Stride: 0x1C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Describes destinations for cannons/pipes used in certain stages (mostly</span>
<span class="sd">    in battle stages). Cannon indices are used by specialized collision types.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ktpc:</span>
<span class="sd">      :end-before: .. _nkm-table-ktpm:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Cannon/pipe logic teleports an object/player to the KTPC destination.</span>
<span class="sd">    - The cannon_index can be used as a link between activator and destination.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - In many tracks this section is small or absent; treat missing sections</span>
<span class="sd">      gracefully when writing tools that modify KTPC entries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cannon_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="KTPM">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.KTPM">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KTPM</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KTPM — Mission points.</span>

<span class="sd">    Stride: 0x1C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Points used by mission objectives (mission mode). They often resemble</span>
<span class="sd">    KTPS/KTP2 entries but have mission-specific indexing.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ktpm:</span>
<span class="sd">      :end-before: .. _nkm-table-cpoi:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Missions may use these points to define target positions or spawns.</span>
<span class="sd">    - `index` can be used in mission scripts to select a specific point</span>
<span class="sd">      out of the KTPM array.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - If the track is not a mission type, these often default to 0xFFFF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="CPOI">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.CPOI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CPOI</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CPOI — Checkpoints (2D oriented).</span>

<span class="sd">    Stride: 0x24 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines checkpoint segments used for lap counting, key handling, and</span>
<span class="sd">    respawn logic. CPOI includes two 2D positions and precomputed trig/distance</span>
<span class="sd">    values used by the engine to determine crossing and checkpoint ordering.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-cpoi:</span>
<span class="sd">      :end-before: .. _nkm-table-cpat:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - CPOIs are the canonical gate the engine checks for lap progress.</span>
<span class="sd">    - The Key ID allows some checkpoints to behave as keys (for gates, or race</span>
<span class="sd">      logic). If Key ID == 0x0000 the point counts as the lap marker.</span>
<span class="sd">    - The precomputed sinus/cosinus/distance allow the engine to quickly test</span>
<span class="sd">      whether a player crossed the checkpoint along the correct orientation.</span>

<span class="sd">    Reverse-Engineering Notes</span>
<span class="sd">    -------------------------</span>
<span class="sd">    - Community docs note the `section_data` fields are partially decoded for</span>
<span class="sd">      special track logic. If you need precise behavior, compare original</span>
<span class="sd">      tracks and observe in-engine behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_2d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_2d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sinus</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosinus</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_data1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_data2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">respawn_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="CPAT">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.CPAT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CPAT</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CPAT — CPOI grouping (checkpoint groups).</span>

<span class="sd">    Stride: 0x0C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Groups CPOI entries into logical sequences (routes/sections). Each CPAT</span>
<span class="sd">    entry points to a contiguous block of CPOI points and describes adjacency</span>
<span class="sd">    (previous/next groups) and section order.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-cpat:</span>
<span class="sd">      :end-before: .. _nkm-table-ipoi:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - CPAT allows complex checkpoint graphs (non-linear courses) by connecting</span>
<span class="sd">      multiple CPOI groups.</span>
<span class="sd">    - Useful when a single lap uses multiple discontiguous checkpoint regions.</span>

<span class="sd">    Implementation Notes</span>
<span class="sd">    --------------------</span>
<span class="sd">    - The `next_group` and `prev_group` arrays use 0xFF as &quot;unused&quot;; treat</span>
<span class="sd">      sentinel values accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_length</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_s16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="IPOI">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.IPOI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IPOI</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IPOI — Item spawn points.</span>

<span class="sd">    Stride: 0x14 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Describes where items (like red shells, bananas) may spawn or where items</span>
<span class="sd">    follow a path along a route. IPOI entries are often referenced by KTPJ</span>
<span class="sd">    (respawn) or object logic.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ipoi:</span>
<span class="sd">      :end-before: .. _nkm-table-ipat:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Items may spawn at IPOI locations or be used for scripted item routes.</span>
<span class="sd">    - `point_scale` may modify spawn probability or area radius.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The unknown 32-bit value is often zero; it may contain bitflags in</span>
<span class="sd">      certain custom tracks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="IPAT">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.IPAT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IPAT</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IPAT — IPOI grouping.</span>

<span class="sd">    Stride: 0x0C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Group IPOI entries into contiguous point ranges and define adjacency, much</span>
<span class="sd">    like CPAT but for item points.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-ipat:</span>
<span class="sd">      :end-before: .. _nkm-table-epoi:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Used by item routing and by respawn selection to find nearby item points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_length</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_s16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="EPOI">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.EPOI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EPOI</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EPOI — Enemy/CPU path points.</span>

<span class="sd">    Stride: 0x18 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines points that the CPU opponents use for their routing (AI paths).</span>
<span class="sd">    These influence how CPUs drive the course (lines, drifting behavior, etc).</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-epoi:</span>
<span class="sd">      :end-before: .. _nkm-table-epat:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - CPU behavior heavily depends on EPOI positions and the drifting</span>
<span class="sd">      parameter — altering these can change how tight/loose CPUs corner.</span>
<span class="sd">    - EPOI groups are linked via EPAT entries (below).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The meaning of the 0x14 32-bit word is partially unknown in community</span>
<span class="sd">      docs; experiments suggest it can contain flags for AI behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drifting</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="EPAT">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.EPAT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EPAT</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EPAT — EPOI grouping.</span>

<span class="sd">    Stride: 0x0C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Groups EPOI points into contiguous blocks and defines adjacency (next/prev</span>
<span class="sd">    groups) and section ordering. Used by CPU pathing code to navigate routes.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-epat:</span>
<span class="sd">      :end-before: .. _nkm-table-mepo:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - EPAT partitions EPOI arrays into logical AI routes; enabling multiple</span>
<span class="sd">      CPU strategies per segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_length</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_s16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="MEPO">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.MEPO">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MEPO</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MEPO — Mini-game enemy points.</span>

<span class="sd">    Stride: 0x18 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Similar to EPOI but used by specific mini-games; describes where minigame</span>
<span class="sd">    entities spawn/move.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-mepo:</span>
<span class="sd">      :end-before: .. _nkm-table-mepa:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - MEPO entries are used only in special mini-game contexts and may allow</span>
<span class="sd">      more variety (hence Int32 for drifting).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drifting</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="MEPA">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.MEPA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MEPA</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MEPA — MEPO grouping (for mini-games).</span>

<span class="sd">    Stride: 0x14 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Groups MEPO points into sequences. MEPA entries support up to 8 next and</span>
<span class="sd">    8 previous groups (Byte[8]) because mini-games may have richer topology.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-mepa:</span>
<span class="sd">      :end-before: .. _nkm-table-nkm:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - Use MEPA to create complex mini-game movement graphs (multiple branching).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_length</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_group</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">]</span></div>



<div class="viewcode-block" id="AREA">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.AREA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AREA</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AREA — Camera/zone areas.</span>

<span class="sd">    Stride: 0x48 bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines 3D regions used by the engine for camera selection and environmental</span>
<span class="sd">    triggers (sounds like waterfalls). Each area contains a center position,</span>
<span class="sd">    axes/length vectors (defining an oriented bounding box), and metadata such</span>
<span class="sd">    as area type and camera ID.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-area:</span>
<span class="sd">      :end-before: .. _nkm-table-came:</span>

<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - AREA sections usually determine which camera the engine should switch to</span>
<span class="sd">      when the player is inside the region.</span>
<span class="sd">    - Camera ID links to CAME entries; Area type allows special behavior (e.g.,</span>
<span class="sd">      waterfall sound triggers).</span>
<span class="sd">    - Good for editors to preview camera transitions.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Several fields are still undocumented; their meaning varies by track.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown3</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown4</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_type</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: parse as Byte at 0x44 if desired</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown5</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_s16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown6</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="CAME">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.CAME">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CAME</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CAME — Camera definitions.</span>

<span class="sd">    Stride: 0x4C bytes per entry.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Defines camera motions and static camera positions used in cutscenes,</span>
<span class="sd">    intros, and dynamic in-game camera triggers. Camera entries are often linked</span>
<span class="sd">    by AREA zones or object routes.</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-came:</span>
<span class="sd">      :end-before: .. _nkm-table-came-again:</span>

<span class="sd">    .. include:: /_includes/nkm_tables.rst</span>
<span class="sd">      :start-after: .. _nkm-table-came-again:</span>
<span class="sd">      :end-before: .. _nkm-table-end:</span>

<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Gameplay Context</span>
<span class="sd">    ----------------</span>
<span class="sd">    - CAME entries drive cinematic camera movement during intros, cutscenes,</span>
<span class="sd">      and special camera modes.</span>
<span class="sd">    - Linked route + point speed define how the camera follows a PATH.</span>
<span class="sd">    - Camera duration uses 1/60th-second units — helpful for exact timing.</span>

<span class="sd">    Notes &amp; Community Tips</span>
<span class="sd">    ----------------------</span>
<span class="sd">    - Many of these fields are precomputed (sine/cosine) for faster in-engine</span>
<span class="sd">      interpolation. Editors can either preserve or recompute them.</span>
<span class="sd">    - The &quot;next camera&quot; field allows building camera chains for sequences.</span>
<span class="sd">    - When building camera editors, expose both positions and FOV values to</span>
<span class="sd">      enable previewing transitions correctly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position1</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position2</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position3</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_vector_3d_fx32</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_begin</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_begin_sine</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_begin_cosine</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_end</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_end_sine</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov_end_cosine</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_fx16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_zoom</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_type</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: parse if you want the raw value at 0x3E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linked_route</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">route_speed</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_speed</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_camera</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u16</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intro_pan_first_camera_indicator</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_u8</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="NKM">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.NKM">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NKM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NKM — Mario Kart DS Course Map parser.</span>

<span class="sd">    Purpose</span>
<span class="sd">    -------</span>
<span class="sd">    Top-level container that parses the NKM file header and initializes objects</span>
<span class="sd">    representing each section (OBJI, PATH, POIT, STAG, KTPS, ... , CAME).</span>

<span class="sd">    Usage Example</span>
<span class="sd">    ----------------</span>
<span class="sd">    &gt;&gt;&gt; nkm = NKM.from_file(&quot;my_course.nkm&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(len(nkm._OBJI))         # number of object instances</span>
<span class="sd">    &gt;&gt;&gt; print(nkm._STAG.amt_of_laps)  # global lap count for the stage</span>

<span class="sd">    Implementation Details</span>
<span class="sd">    ----------------------</span>
<span class="sd">    * The typical header length is 0x4C and contains offsets (UInt32) to 17</span>
<span class="sd">      canonical sections in standard order. Offsets are relative to the end of</span>
<span class="sd">      the header (H), so they are added to `_header_offset` to compute absolute</span>
<span class="sd">      positions inside the file.</span>
<span class="sd">    * This parser assumes the &quot;typical&quot; header layout. If an NKM contains</span>
<span class="sd">      additional special sections (like NKMI) or a different header length,</span>
<span class="sd">      additional handling will be required.</span>
<span class="sd">    * Parsing is defensive but assumes the file is well-formed; for robust</span>
<span class="sd">      tools consider adding bounds checks when slicing `self._data[...]`.</span>

<span class="sd">    Known Limitations</span>
<span class="sd">    -----------------</span>
<span class="sd">    - Some fields (GXRgb, camera_type, some unknown bytes) are left as None or</span>
<span class="sd">      unknown placeholders. Implementing GXRgb and Fx16/Fx32 conversions will</span>
<span class="sd">      enable richer output.</span>
<span class="sd">    - The code currently uses `PATH.has_loop = read_u8(...) != 1` which inverts</span>
<span class="sd">      the canonical meaning (spec: 1 means loop). Consider normalizing this if</span>
<span class="sd">      you rely on literal interpretation elsewhere.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    The official NKM spec (community wiki) for exhaustive explanation of flags</span>
<span class="sd">    and object-specific settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_header_offset</span> <span class="o">=</span> <span class="mh">0x4C</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_h</span> <span class="o">=</span> <span class="mh">0x4C</span>
        <span class="c1"># Header contains offsets relative to header_end; add header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_OBJI_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PATH_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_POIT_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_STAG_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPS_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPJ_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTP2_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPC_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPM_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CPOI_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CPAT_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IPOI_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IPAT_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EPOI_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EPAT_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_AREA_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CAME_offset</span> <span class="o">=</span> <span class="n">read_u32</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">)</span> <span class="o">+</span> <span class="n">NKM</span><span class="o">.</span><span class="n">_header_offset</span>

        <span class="c1"># Instantiate section objects. Slicing uses computed offsets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_OBJI</span> <span class="o">=</span> <span class="n">OBJI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_OBJI_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_PATH_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PATH</span> <span class="o">=</span> <span class="n">PATH</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_PATH_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_POIT_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_POIT</span> <span class="o">=</span> <span class="n">POIT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_POIT_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_STAG_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_STAG</span> <span class="o">=</span> <span class="n">STAG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_STAG_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPS_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPS</span> <span class="o">=</span> <span class="n">KTPS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPS_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPJ_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPJ</span> <span class="o">=</span> <span class="n">KTPJ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPJ_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTP2_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTP2</span> <span class="o">=</span> <span class="n">KTP2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTP2_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPC_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPC</span> <span class="o">=</span> <span class="n">KTPC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPC_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPM_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_KTPM</span> <span class="o">=</span> <span class="n">KTPM</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_KTPM_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_CPOI_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CPOI</span> <span class="o">=</span> <span class="n">CPOI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_CPOI_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_CPAT_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CPAT</span> <span class="o">=</span> <span class="n">CPAT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_CPAT_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_IPOI_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IPOI</span> <span class="o">=</span> <span class="n">IPOI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_IPOI_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_IPAT_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IPAT</span> <span class="o">=</span> <span class="n">IPAT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_IPAT_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_EPOI_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EPOI</span> <span class="o">=</span> <span class="n">EPOI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EPOI_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_EPAT_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EPAT</span> <span class="o">=</span> <span class="n">EPAT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EPAT_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_AREA_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_AREA</span> <span class="o">=</span> <span class="n">AREA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_AREA_offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_CAME_offset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CAME</span> <span class="o">=</span> <span class="n">CAME</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_CAME_offset</span><span class="p">:])</span>

<div class="viewcode-block" id="NKM.from_file">
<a class="viewcode-back" href="../../api/mkds/nkm.html#mkds.nkm.NKM.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an NKM file from disk and parse its sections.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the `.nkm` file. Defaults to DEFAULT_NKM_PATH.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NKM: The parsed NKM object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NKM file not found at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Blake Moody
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>