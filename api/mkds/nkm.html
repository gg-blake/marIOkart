<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="mkds.kcl module" href="kcl.html"><link rel="prev" title="MKDS File Parsing Library" href="../mkds.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>mkds.nkm module - MarI/O Kart documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">MarI/O Kart  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">MarI/O Kart  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../articles/articles.html">Research Articles</a><input aria-label="Toggle navigation of Research Articles" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../articles/OVERLAYS.html">MKDS Overlay System — Extensible Overlays for Mario Kart DS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../articles/READING_MEMORY.html">MKDS Emulator I/O &amp; Geometry Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../articles/READING_FILES.html"><code class="docutils literal notranslate"><span class="pre">mkds</span></code> — Mario Kart DS NKM &amp; KCL Readers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src.core.html">src.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src.mkds_extensions.html">src.mkds_extensions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src.utils.html">src.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src.visualization.html">src.visualization package</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../mkds.html">MKDS File Parsing Library</a><input aria-label="Toggle navigation of MKDS File Parsing Library" checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">mkds.nkm module</a></li>
<li class="toctree-l2"><a class="reference internal" href="kcl.html">mkds.kcl module</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">mkds.utils module</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/api/mkds/nkm.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-mkds.nkm">
<span id="mkds-nkm-module"></span><h1>mkds.nkm module<a class="headerlink" href="#module-mkds.nkm" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.Section">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">Section</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#Section"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.Section" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Base class for sections in an NKM file.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>Most NKM sections (all except STAG) begin with an 8-byte section header:</dt><dd><ul class="simple">
<li><p>0x00 (4 bytes): Section magic (ASCII, e.g., “OBJI”).</p></li>
<li><p>0x04 (4 bytes): Number of entries in the section (UInt32).</p></li>
</ul>
</dd>
</dl>
<p>Immediately after the header the section contains <cite>entry_count</cite> entries,
each with a fixed stride (size) which is specified by the concrete Section
subclass.</p>
<dl class="simple">
<dt>This base class encapsulates:</dt><dd><ul class="simple">
<li><p>raw <cite>data</cite> for the whole section (header + entries)</p></li>
<li><p><cite>stride</cite> (size in bytes of a single entry)</p></li>
<li><p><cite>entry_count</cite> parsed from the header</p></li>
<li><p>an iterator over each fixed-size entry slice</p></li>
</ul>
</dd>
</dl>
<section id="notes-caveats">
<h3>Notes / Caveats<a class="headerlink" href="#notes-caveats" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>This class assumes the <cite>data</cite> passed includes the section header.</p></li>
<li><p>If a section contains variable-length entries (rare in NKM), a custom
parser should be used instead of relying on a fixed stride.</p></li>
<li><p>Many sections have fields where 0xFFFF or 0xFF indicates “unused” or
“none” — callers should treat those sentinel values accordingly.</p></li>
</ul>
</section>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.OBJI">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">OBJI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#OBJI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.OBJI" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>OBJI — Object Instances section.</p>
<p>Stride: 0x3C bytes per entry.</p>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h2>
<p>Describes every object placed in the track: visual decorations, interactive
objects, obstacle instances, item boxes, etc. These objects are instantiated
by the game engine and can be linked to PATH routes.</p>
</section>
<section id="obji-entry-structure">
<h2>OBJI Entry Structure<a class="headerlink" href="#obji-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector (FX32).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">scale</span></code></p></td>
<td><p>3D scale vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x24</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">object_id</span></code></p></td>
<td><p>Object ID (model/behavior).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x26</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">route_id</span></code></p></td>
<td><p>Route ID (0xFFFF = none).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x28</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">setting0</span></code></p></td>
<td><p>Object-specific setting 0.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x2C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">setting1</span></code></p></td>
<td><p>Object-specific setting 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x30</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">setting2</span></code></p></td>
<td><p>Object-specific setting 2.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x34</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">setting3</span></code></p></td>
<td><p>Object-specific setting 3.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x38</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">show_tt</span></code></p></td>
<td><p>Visible in Time Trials (1=yes,0=no).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="gameplay-context">
<h2>Gameplay Context<a class="headerlink" href="#gameplay-context" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The object ID decides both model and in some cases runtime logic (collision,
activatable behaviors).</p></li>
<li><p>The route_id links the object to a PATH. If present, the object will be
moved/animated by the PATH’s POIT points at runtime (e.g., moving platforms,
cameras).</p></li>
<li><p>The object settings are used by many object types to control behavior:
rotation speed, spawn flags, timers, random seeds, or other per-object
parameters. Different object IDs require different decoding logic.</p></li>
</ul>
</section>
<section id="reverse-engineering-notes-tips">
<h2>Reverse-Engineering Notes / Tips<a class="headerlink" href="#reverse-engineering-notes-tips" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The four 32-bit settings differ radically between object types — community
wikis often contain per-object decode rules (use object ID to branch).</p></li>
<li><p>The presence of a non-0 or non-0xFFFFFFFF route_id often means the object
will be animated along that route; route indices are bytes in PATH entries
but stored here as a 16-bit value (keep an eye on sign/width).</p></li>
<li><p>Show-in-time-trials: historically some editors used 0/1 inverse; verify
against known tracks when in doubt.</p></li>
</ul>
</section>
<section id="parsing-caveat">
<h2>Parsing Caveat<a class="headerlink" href="#parsing-caveat" title="Link to this heading">¶</a></h2>
<p>We read <cite>object_id</cite> as <cite>read_u16</cite> and <cite>route_id</cite> as <cite>read_u16</cite>. Consumers of
this class should treat 0xFFFF in <cite>route_id</cite> as “no route”.</p>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.PATH">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">PATH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#PATH"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.PATH" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>PATH — Path metadata.</p>
<p>Stride: 0x04 bytes per entry.</p>
<section id="id1">
<h2>Purpose<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>Describes metadata for routes used by objects and cameras. Each PATH entry
points to a sequence of POIT entries (control points) that define the route.</p>
</section>
<section id="path-entry-structure">
<h2>PATH Entry Structure<a class="headerlink" href="#path-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">route_id</span></code></p></td>
<td><p>Route identifier.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x01</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">loop</span></code></p></td>
<td><p>1 if route loops, else 0.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_ct</span></code></p></td>
<td><p>Number of POIT points.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id2">
<h2>Gameplay Context<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Objects or cameras that reference a route will move along the POIT points
in order; if the loop flag is set, the route repeats.</p></li>
<li><p>Route ID is commonly a small integer; the PATH list enumerates all routes
in use on the track.</p></li>
</ul>
</section>
<section id="reverse-engineering-notes-caveats">
<h2>Reverse-Engineering Notes / Caveats<a class="headerlink" href="#reverse-engineering-notes-caveats" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The canonical spec states: 0x01 == 1 if the route loops, 0 otherwise.
In the code you originally used <cite>read_u8(d, 0x01) != 1</cite> (which inverts
the meaning). I have NOT altered your logic — but be aware of the
discrepancy: callers should expect <cite>True</cite> when the route loops.
Consider changing to <cite>read_u8(… ) == 1</cite> for clarity.</p></li>
<li><p><cite>point_count</cite> enumerates POIT entries but the mapping from global POIT
index to route is (index offset + length) — consumers should reconstruct
the actual POIT index ranges using CPAT/EPAT/IPAT/MEPA grouping sections
when applicable (these groupings partition points).</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.POIT">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">POIT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#POIT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.POIT" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>POIT — Path points (control points).</p>
<p>Stride: 0x14 bytes per entry.</p>
<section id="id3">
<h2>Purpose<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>Stores the actual 3D points used by PATH routes. Points are grouped by route
using the counts stored in PATH plus the various <a href="#id4"><span class="problematic" id="id5">*</span></a>PAT grouping sections.</p>
</section>
<section id="poit-entry-structure">
<h2>POIT Entry Structure<a class="headerlink" href="#poit-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>Point index in route.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0D</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown1</span></code></p></td>
<td><p>Unknown/padding.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">duration</span></code></p></td>
<td><p>Point duration (optional).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown2</span></code></p></td>
<td><p>Reserved/unknown.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id6">
<h2>Gameplay Context<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Moving objects and cameras read these points sequentially to interpolate
positions. The “point_index” normally indicates position in the route’s
ordering (0,1,2,…).</p></li>
<li><p>Some cameras or scripted objects use <cite>point_duration</cite> to wait between
points, enabling non-linear motion.</p></li>
<li><p>POIT order in the file is important: group membership is often determined
by successive ranges; use PAT sections to map ranges to specific routes.</p></li>
</ul>
</section>
<section id="reverse-engineering-notes">
<h2>Reverse-Engineering Notes<a class="headerlink" href="#reverse-engineering-notes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The unknown fields often show consistent patterns per track editor —
check community resources to decode them for special behaviors.</p></li>
<li><p>Some older track versions or beta files encode rotation differently; when
in doubt, cross-check with KTPJ notes for version-dependent behavior.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.STAG">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">STAG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#STAG"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.STAG" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>STAG — Stage (track) information.</p>
<p>Fixed-size: The STAG section is unique in NKM: it does NOT have a section
header and is a single 0x2C-byte structure placed directly in the file
(after POIT in the canonical header ordering).</p>
<section id="id7">
<h2>Purpose<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<p>Contains global track settings: track ID, default lap count, fog settings,
colors used by KCL (collision visual palettes), and other miscellaneous bytes.</p>
</section>
<section id="stag-entry-structure">
<h2>STAG Entry Structure<a class="headerlink" href="#stag-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">char[4]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">magic</span></code></p></td>
<td><p>Always “STAG”.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">track_id</span></code></p></td>
<td><p>Track ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">laps</span></code></p></td>
<td><p>Lap count.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown1</span></code></p></td>
<td><p>Unknown small integer.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x09</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_enabled</span></code></p></td>
<td><p>1 = fog on, 0 = off.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_mode</span></code></p></td>
<td><p>Fog generation mode.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_slope</span></code></p></td>
<td><p>Fog slope.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u0</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0D</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u1</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u2</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0F</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u3</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u4</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x11</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u5</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x12</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u6</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x13</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u7</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x14</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_dist</span></code></p></td>
<td><p>Fog distance.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GXRgb</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_color</span></code></p></td>
<td><p>Fog color.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fog_alpha</span></code></p></td>
<td><p>Fog alpha (0–15).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x1C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GXRgb</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kcl_color1</span></code></p></td>
<td><p>Default KCL color 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GXRgb</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kcl_color2</span></code></p></td>
<td><p>Default KCL color 2.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x20</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GXRgb</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kcl_color3</span></code></p></td>
<td><p>Default KCL color 3.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x22</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GXRgb</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kcl_color4</span></code></p></td>
<td><p>Default KCL color 4.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x24</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v0</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x25</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v1</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x26</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v2</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x27</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v3</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x28</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v4</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x29</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v5</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x2A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v6</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x2B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">v7</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id8">
<h2>Gameplay Context<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Amount of laps controls how many laps the race uses by default for the
stage; some tracks use lap_count = 0 for special cases (verify per track).</p></li>
<li><p>Fog parameters influence rendering: enabling fog can hide distant objects
and alter perceived depth; fog color &amp; distance control atmosphere.</p></li>
<li><p>KCL colors are the default palette for collision visualization (useful
for editors and collision debugging).</p></li>
</ul>
</section>
<section id="implementation-notes">
<h2>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>This class sets placeholders for color fields (GXRgb) — you can implement
<cite>GXRgb</cite> decoding (usually 2 bytes per color or platform-specific) and
populate these fields for richer output.</p></li>
<li><p>The unknown arrays are repeated in code (unknown2 and unknown3) — that
mirrors the spec layout but may be redundant; keep one copy or rename for
clarity if desired.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.KTPS">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">KTPS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#KTPS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.KTPS" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>KTPS — Kart/Start Positions (Start points for racers).</p>
<p>Stride: 0x1C bytes per entry.</p>
<section id="id9">
<h2>Purpose<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<p>Defines start positions (spawn/starting grid) for players/racers. Typically
used for the main race starts; can also be used in battle or mission modes.</p>
</section>
<section id="ktps-entry-structure">
<h2>KTPS Entry Structure<a class="headerlink" href="#ktps-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector (spawn).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">padding</span></code></p></td>
<td><p>Padding (0xFFFF).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>Start index (battle/mission).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id10">
<h2>Gameplay Context<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>On race start, the game picks starting positions from this section.</p></li>
<li><p><cite>start_position_index</cite> is relevant for battle stages or mission mode where
start ordering differs from main racing.</p></li>
<li><p>The rotation vector might be stored differently in beta versions — the
canonical community notes indicate the Y-rotation sometimes needs to be
computed via Atan2 on rotation vector components for older versions.</p></li>
</ul>
</section>
<section id="notes-community-tips">
<h2>Notes / Community Tips<a class="headerlink" href="#notes-community-tips" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Typically the number of KTPS entries equals the number of players or more
(some tracks list more possible starts than vehicles).</p></li>
<li><p>If you want to reposition start locations, modify positions and write the
file back in FX32 format.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.KTPJ">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">KTPJ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#KTPJ"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.KTPJ" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>KTPJ — Respawn positions (kart respawn).</p>
<p>Stride: 0x20 bytes per entry.</p>
<section id="id11">
<h2>Purpose<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h2>
<p>Positions to which a kart (player) can respawn after falling off or during
certain scripted events. Contains references to enemy/item points (EPOI/IPOI)
to determine nearby behavior or AI context.</p>
</section>
<section id="ktpj-entry-structure">
<h2>KTPJ Entry Structure<a class="headerlink" href="#ktpj-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">enemy_id</span></code></p></td>
<td><p>Enemy position ID (EPOI).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">item_id</span></code></p></td>
<td><p>Item position ID (IPOI).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x1C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">respawn_id</span></code></p></td>
<td><p>Respawn identifier.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id12">
<h2>Gameplay Context<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>When a kart falls off the track or hits a severe collision, the engine
picks a KTPJ respawn that matches the current lap and nearby conditions.</p></li>
<li><p>The enemy/item IDs let respawn logic pick nearby AI/item spawn points for
smoother reintroduction.</p></li>
</ul>
</section>
<section id="version-notes">
<h2>Version Notes<a class="headerlink" href="#version-notes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>For version 0x1E (older beta), the final Respawn ID (0x1C) may not exist.</p></li>
<li><p>The rotation encoding changed for early beta versions; if reading older
tracks, compute Y-rotation via atan2(Rx, Rz) to convert to degrees.</p></li>
</ul>
</section>
<section id="remarks-for-parser">
<h2>Remarks for Parser<a class="headerlink" href="#remarks-for-parser" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>We read <cite>respawn_id</cite> as a 32-bit value; if parsing older tracks that omit
it, ensure you guard read beyond section length.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.KTP2">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">KTP2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#KTP2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.KTP2" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>KTP2 — Lap checkpoints (points to pass to count lap progress).</p>
<p>Stride: 0x1C bytes per entry.</p>
<section id="id13">
<h2>Purpose<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<p>Defines the “lap gate” points that the engine checks to determine whether a
player completed a lap. Usually combined with timing/ordering checks.</p>
</section>
<section id="ktp2-entry-structure">
<h2>KTP2 Entry Structure<a class="headerlink" href="#ktp2-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">padding</span></code></p></td>
<td><p>Padding (0xFFFF).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>Index (0xFFFF typical).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id14">
<h2>Gameplay Context<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The race logic queries these points as canonical lap markers.</p></li>
<li><p>Often unused fields are set to 0xFFFF; do not treat them as valid indices.</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The “Index” is usually unused (set to 0xFFFF); if present, it may
participate in specialized lap logic or developer tools.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.KTPC">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">KTPC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#KTPC"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.KTPC" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>KTPC — Cannon / Pipe destination points.</p>
<p>Stride: 0x1C bytes per entry.</p>
<section id="id15">
<h2>Purpose<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<p>Describes destinations for cannons/pipes used in certain stages (mostly
in battle stages). Cannon indices are used by specialized collision types.</p>
</section>
<section id="ktpc-entry-structure">
<h2>KTPC Entry Structure<a class="headerlink" href="#ktpc-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position (destination).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cannon_idx</span></code></p></td>
<td><p>Cannon index (links activator/destination).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id16">
<h2>Gameplay Context<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Cannon/pipe logic teleports an object/player to the KTPC destination.</p></li>
<li><p>The cannon_index can be used as a link between activator and destination.</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>In many tracks this section is small or absent; treat missing sections
gracefully when writing tools that modify KTPC entries.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.KTPM">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">KTPM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#KTPM"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.KTPM" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>KTPM — Mission points.</p>
<p>Stride: 0x1C bytes per entry.</p>
<section id="id17">
<h2>Purpose<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h2>
<p>Points used by mission objectives (mission mode). They often resemble
KTPS/KTP2 entries but have mission-specific indexing.</p>
</section>
<section id="ktpm-entry-structure">
<h2>KTPM Entry Structure<a class="headerlink" href="#ktpm-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>3D rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">padding</span></code></p></td>
<td><p>Padding (0xFFFF).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>Mission index.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id18">
<h2>Gameplay Context<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Missions may use these points to define target positions or spawns.</p></li>
<li><p><cite>index</cite> can be used in mission scripts to select a specific point
out of the KTPM array.</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>If the track is not a mission type, these often default to 0xFFFF.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.CPOI">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">CPOI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#CPOI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.CPOI" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>CPOI — Checkpoints (2D oriented).</p>
<p>Stride: 0x24 bytes per entry.</p>
<section id="id19">
<h2>Purpose<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h2>
<p>Defines checkpoint segments used for lap counting, key handling, and
respawn logic. CPOI includes two 2D positions and precomputed trig/distance
values used by the engine to determine crossing and checkpoint ordering.</p>
</section>
<section id="cpoi-entry-structure">
<h2>CPOI Entry Structure<a class="headerlink" href="#cpoi-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span> <span class="pre">(2D)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos1</span></code></p></td>
<td><p>2D position 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span> <span class="pre">(2D)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos2</span></code></p></td>
<td><p>2D position 2 (other edge).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sin</span></code></p></td>
<td><p>Precomputed sine.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x14</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cos</span></code></p></td>
<td><p>Precomputed cosine.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">distance</span></code></p></td>
<td><p>Distance between pos1/pos2.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x1C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">section1</span></code></p></td>
<td><p>Section data 1 (unknown).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x1E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">section2</span></code></p></td>
<td><p>Section data 2 (unknown).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x20</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">key_id</span></code></p></td>
<td><p>0x0000=lap, 0xFFFF=none.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x22</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">respawn_id</span></code></p></td>
<td><p>Respawn ID.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x23</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>Unknown/padding.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id20">
<h2>Gameplay Context<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>CPOIs are the canonical gate the engine checks for lap progress.</p></li>
<li><p>The Key ID allows some checkpoints to behave as keys (for gates, or race
logic). If Key ID == 0x0000 the point counts as the lap marker.</p></li>
<li><p>The precomputed sinus/cosinus/distance allow the engine to quickly test
whether a player crossed the checkpoint along the correct orientation.</p></li>
</ul>
</section>
<section id="id21">
<h2>Reverse-Engineering Notes<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Community docs note the <cite>section_data</cite> fields are partially decoded for
special track logic. If you need precise behavior, compare original
tracks and observe in-engine behavior.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.CPAT">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">CPAT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#CPAT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.CPAT" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>CPAT — CPOI grouping (checkpoint groups).</p>
<p>Stride: 0x0C bytes per entry.</p>
<section id="id22">
<h2>Purpose<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h2>
<p>Groups CPOI entries into logical sequences (routes/sections). Each CPAT
entry points to a contiguous block of CPOI points and describes adjacency
(previous/next groups) and section order.</p>
</section>
<section id="cpat-entry-structure">
<h2>CPAT Entry Structure<a class="headerlink" href="#cpat-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_start</span></code></p></td>
<td><p>Start index into CPOI array.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_len</span></code></p></td>
<td><p>Number of points.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next0</span></code></p></td>
<td><p>Next group index 0.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x05</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next1</span></code></p></td>
<td><p>Next group index 1.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next2</span></code></p></td>
<td><p>Next group index 2.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x07</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev0</span></code></p></td>
<td><p>Previous group index 0.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev1</span></code></p></td>
<td><p>Previous group index 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x09</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev2</span></code></p></td>
<td><p>Previous group index 2.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">section_order</span></code></p></td>
<td><p>Section ordering index.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id23">
<h2>Gameplay Context<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>CPAT allows complex checkpoint graphs (non-linear courses) by connecting
multiple CPOI groups.</p></li>
<li><p>Useful when a single lap uses multiple discontiguous checkpoint regions.</p></li>
</ul>
</section>
<section id="id24">
<h2>Implementation Notes<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The <cite>next_group</cite> and <cite>prev_group</cite> arrays use 0xFF as “unused”; treat
sentinel values accordingly.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.IPOI">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">IPOI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#IPOI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.IPOI" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>IPOI — Item spawn points.</p>
<p>Stride: 0x14 bytes per entry.</p>
<section id="id25">
<h2>Purpose<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h2>
<p>Describes where items (like red shells, bananas) may spawn or where items
follow a path along a route. IPOI entries are often referenced by KTPJ
(respawn) or object logic.</p>
</section>
<section id="ipoi-entry-structure">
<h2>IPOI Entry Structure<a class="headerlink" href="#ipoi-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">scale</span></code></p></td>
<td><p>Point scale (size/weight).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>Reserved field.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id26">
<h2>Gameplay Context<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Items may spawn at IPOI locations or be used for scripted item routes.</p></li>
<li><p><cite>point_scale</cite> may modify spawn probability or area radius.</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The unknown 32-bit value is often zero; it may contain bitflags in
certain custom tracks.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.IPAT">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">IPAT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#IPAT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.IPAT" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>IPAT — IPOI grouping.</p>
<p>Stride: 0x0C bytes per entry.</p>
<section id="id27">
<h2>Purpose<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h2>
<p>Group IPOI entries into contiguous point ranges and define adjacency, much
like CPAT but for item points.</p>
</section>
<section id="ipat-entry-structure">
<h2>IPAT Entry Structure<a class="headerlink" href="#ipat-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_start</span></code></p></td>
<td><p>Start index into IPOI array.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_len</span></code></p></td>
<td><p>Number of points.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next0</span></code></p></td>
<td><p>Next group index 0.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x05</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next1</span></code></p></td>
<td><p>Next group index 1.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next2</span></code></p></td>
<td><p>Next group index 2.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x07</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev0</span></code></p></td>
<td><p>Previous group index 0.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev1</span></code></p></td>
<td><p>Previous group index 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x09</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev2</span></code></p></td>
<td><p>Previous group index 2.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">section_order</span></code></p></td>
<td><p>Section ordering index.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id28">
<h2>Gameplay Context<a class="headerlink" href="#id28" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Used by item routing and by respawn selection to find nearby item points.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.EPOI">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">EPOI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#EPOI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.EPOI" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>EPOI — Enemy/CPU path points.</p>
<p>Stride: 0x18 bytes per entry.</p>
<section id="id29">
<h2>Purpose<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h2>
<p>Defines points that the CPU opponents use for their routing (AI paths).
These influence how CPUs drive the course (lines, drifting behavior, etc).</p>
</section>
<section id="epoi-entry-structure">
<h2>EPOI Entry Structure<a class="headerlink" href="#epoi-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">scale</span></code></p></td>
<td><p>Point scale (radius/weight).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drift</span></code></p></td>
<td><p>Drifting parameter.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x12</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown1</span></code></p></td>
<td><p>Unknown flag.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x14</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown2</span></code></p></td>
<td><p>Engine metadata.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id30">
<h2>Gameplay Context<a class="headerlink" href="#id30" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>CPU behavior heavily depends on EPOI positions and the drifting
parameter — altering these can change how tight/loose CPUs corner.</p></li>
<li><p>EPOI groups are linked via EPAT entries (below).</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The meaning of the 0x14 32-bit word is partially unknown in community
docs; experiments suggest it can contain flags for AI behavior.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.EPAT">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">EPAT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#EPAT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.EPAT" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>EPAT — EPOI grouping.</p>
<p>Stride: 0x0C bytes per entry.</p>
<section id="id31">
<h2>Purpose<a class="headerlink" href="#id31" title="Link to this heading">¶</a></h2>
<p>Groups EPOI points into contiguous blocks and defines adjacency (next/prev
groups) and section ordering. Used by CPU pathing code to navigate routes.</p>
</section>
<section id="epat-entry-structure">
<h2>EPAT Entry Structure<a class="headerlink" href="#epat-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_start</span></code></p></td>
<td><p>Start index into EPOI array.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_len</span></code></p></td>
<td><p>Number of points.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next0</span></code></p></td>
<td><p>Next group index 0.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x05</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next1</span></code></p></td>
<td><p>Next group index 1.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next2</span></code></p></td>
<td><p>Next group index 2.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x07</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev0</span></code></p></td>
<td><p>Previous group index 0.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev1</span></code></p></td>
<td><p>Previous group index 1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x09</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prev2</span></code></p></td>
<td><p>Previous group index 2.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x0A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">section_order</span></code></p></td>
<td><p>Section ordering index.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id32">
<h2>Gameplay Context<a class="headerlink" href="#id32" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>EPAT partitions EPOI arrays into logical AI routes; enabling multiple
CPU strategies per segment.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.MEPO">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">MEPO</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#MEPO"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.MEPO" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>MEPO — Mini-game enemy points.</p>
<p>Stride: 0x18 bytes per entry.</p>
<section id="id33">
<h2>Purpose<a class="headerlink" href="#id33" title="Link to this heading">¶</a></h2>
<p>Similar to EPOI but used by specific mini-games; describes where minigame
entities spawn/move.</p>
</section>
<section id="mepo-entry-structure">
<h2>MEPO Entry Structure<a class="headerlink" href="#mepo-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>3D position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">scale</span></code></p></td>
<td><p>Point scale.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drifting</span></code></p></td>
<td><p>Drifting parameter (32-bit).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x14</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>Unknown/reserved.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id34">
<h2>Gameplay Context<a class="headerlink" href="#id34" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>MEPO entries are used only in special mini-game contexts and may allow
more variety (hence Int32 for drifting).</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.MEPA">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">MEPA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#MEPA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.MEPA" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>MEPA — MEPO grouping (for mini-games).</p>
<p>Stride: 0x14 bytes per entry.</p>
<section id="id35">
<h2>Purpose<a class="headerlink" href="#id35" title="Link to this heading">¶</a></h2>
<p>Groups MEPO points into sequences. MEPA entries support up to 8 next and
8 previous groups (Byte[8]) because mini-games may have richer topology.</p>
</section>
<section id="id36">
<h2>Gameplay Context<a class="headerlink" href="#id36" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Use MEPA to create complex mini-game movement graphs (multiple branching).</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.AREA">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">AREA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#AREA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.AREA" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>AREA — Camera/zone areas.</p>
<p>Stride: 0x48 bytes per entry.</p>
<section id="id37">
<h2>Purpose<a class="headerlink" href="#id37" title="Link to this heading">¶</a></h2>
<p>Defines 3D regions used by the engine for camera selection and environmental
triggers (sounds like waterfalls). Each area contains a center position,
axes/length vectors (defining an oriented bounding box), and metadata such
as area type and camera ID.</p>
</section>
<section id="area-entry-structure">
<h2>AREA Entry Structure<a class="headerlink" href="#area-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos</span></code></p></td>
<td><p>Center position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">length_vec</span></code></p></td>
<td><p>Length vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x_vec</span></code></p></td>
<td><p>X-axis vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x24</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">y_vec</span></code></p></td>
<td><p>Y-axis vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x30</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">z_vec</span></code></p></td>
<td><p>Z-axis vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x3C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u0</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x3E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u1</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x40</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u2</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x42</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u3</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x43</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">camera_id</span></code></p></td>
<td><p>Camera index (CAME ref).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x44</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">area_type</span></code></p></td>
<td><p>Area type (0x01=camera, etc.).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x45</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u4</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x47</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u5</span></code></p></td>
<td><p>Unknown.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id38">
<h2>Gameplay Context<a class="headerlink" href="#id38" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>AREA sections usually determine which camera the engine should switch to
when the player is inside the region.</p></li>
<li><p>Camera ID links to CAME entries; Area type allows special behavior (e.g.,
waterfall sound triggers).</p></li>
<li><p>Good for editors to preview camera transitions.</p></li>
</ul>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Several fields are still undocumented; their meaning varies by track.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.CAME">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">CAME</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#CAME"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.CAME" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#mkds.nkm.Section" title="mkds.nkm.Section"><code class="xref py py-class docutils literal notranslate"><span class="pre">Section</span></code></a></p>
<p>CAME — Camera definitions.</p>
<p>Stride: 0x4C bytes per entry.</p>
<section id="id39">
<h2>Purpose<a class="headerlink" href="#id39" title="Link to this heading">¶</a></h2>
<p>Defines camera motions and static camera positions used in cutscenes,
intros, and dynamic in-game camera triggers. Camera entries are often linked
by AREA zones or object routes.</p>
</section>
<section id="came-entry-structure">
<h2>CAME Entry Structure<a class="headerlink" href="#came-entry-structure" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Offset</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos1</span></code></p></td>
<td><p>Primary position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x0C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rot</span></code></p></td>
<td><p>Rotation vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x18</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos2</span></code></p></td>
<td><p>Secondary position vector.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x24</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VecFx32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pos3</span></code></p></td>
<td><p>Tertiary position vector.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x30</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_begin</span></code></p></td>
<td><p>Field-of-view start.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_beg_sin</span></code></p></td>
<td><p>Precomputed sine for FOV start.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x34</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_beg_cos</span></code></p></td>
<td><p>Precomputed cosine for FOV start.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x36</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">s16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_end</span></code></p></td>
<td><p>Field-of-view end.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x38</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_end_sin</span></code></p></td>
<td><p>Precomputed sine for FOV end.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x3A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Fx16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fov_end_cos</span></code></p></td>
<td><p>Precomputed cosine for FOV end.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x3C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">zoom</span></code></p></td>
<td><p>Camera zoom factor.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x3E</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>Camera type.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x40</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">linked_route</span></code></p></td>
<td><p>Linked PATH route index (0xFFFF = none).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x42</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">route_speed</span></code></p></td>
<td><p>Speed along linked route.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x44</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">point_speed</span></code></p></td>
<td><p>Speed between points.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x46</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">duration</span></code></p></td>
<td><p>Duration (1/60s units).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x48</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">next_cam</span></code></p></td>
<td><p>Next camera index (0xFFFF = none).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x4A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">intro_pan</span></code></p></td>
<td><p>Intro pan indicator (0=none,1=top,2=bot).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x4B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>Unknown (1 if type==5).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="camera-type-common">
<h2>Camera Type (common)<a class="headerlink" href="#camera-type-common" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Bit Offset</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code></p></td>
<td><p>After race camera</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x01</span></code></p></td>
<td><p>Unknown (with route)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code></p></td>
<td><p>Unknown</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x03</span></code></p></td>
<td><p>Intro camera (top screen)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code></p></td>
<td><p>Intro camera (bottom screen)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x05</span></code></p></td>
<td><p>Unknown</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code></p></td>
<td><p>Unknown</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0x07</span></code></p></td>
<td><p>Battle mode camera</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0x08</span></code></p></td>
<td><p>Mission finish camera</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id40">
<h2>Gameplay Context<a class="headerlink" href="#id40" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>CAME entries drive cinematic camera movement during intros, cutscenes,
and special camera modes.</p></li>
<li><p>Linked route + point speed define how the camera follows a PATH.</p></li>
<li><p>Camera duration uses 1/60th-second units — helpful for exact timing.</p></li>
</ul>
</section>
<section id="id41">
<h2>Notes &amp; Community Tips<a class="headerlink" href="#id41" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Many of these fields are precomputed (sine/cosine) for faster in-engine
interpolation. Editors can either preserve or recompute them.</p></li>
<li><p>The “next camera” field allows building camera chains for sequences.</p></li>
<li><p>When building camera editors, expose both positions and FOV values to
enable previewing transitions correctly.</p></li>
</ul>
</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mkds.nkm.NKM">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mkds.nkm.</span></span><span class="sig-name descname"><span class="pre">NKM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#NKM"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.NKM" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>NKM — Mario Kart DS Course Map parser.</p>
<section id="id42">
<h2>Purpose<a class="headerlink" href="#id42" title="Link to this heading">¶</a></h2>
<p>Top-level container that parses the NKM file header and initializes objects
representing each section (OBJI, PATH, POIT, STAG, KTPS, … , CAME).</p>
</section>
<section id="usage-example">
<h2>Usage Example<a class="headerlink" href="#usage-example" title="Link to this heading">¶</a></h2>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nkm</span> <span class="o">=</span> <span class="n">NKM</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;my_course.nkm&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nkm</span><span class="o">.</span><span class="n">_OBJI</span><span class="p">))</span>         <span class="c1"># number of object instances</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">nkm</span><span class="o">.</span><span class="n">_STAG</span><span class="o">.</span><span class="n">amt_of_laps</span><span class="p">)</span>  <span class="c1"># global lap count for the stage</span>
</pre></div>
</div>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The typical header length is 0x4C and contains offsets (UInt32) to 17
canonical sections in standard order. Offsets are relative to the end of
the header (H), so they are added to <cite>_header_offset</cite> to compute absolute
positions inside the file.</p></li>
<li><p>This parser assumes the “typical” header layout. If an NKM contains
additional special sections (like NKMI) or a different header length,
additional handling will be required.</p></li>
<li><p>Parsing is defensive but assumes the file is well-formed; for robust
tools consider adding bounds checks when slicing <cite>self._data[…]</cite>.</p></li>
</ul>
</section>
<section id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Some fields (GXRgb, camera_type, some unknown bytes) are left as None or
unknown placeholders. Implementing GXRgb and Fx16/Fx32 conversions will
enable richer output.</p></li>
<li><p>The code currently uses <cite>PATH.has_loop = read_u8(…) != 1</cite> which inverts
the canonical meaning (spec: 1 means loop). Consider normalizing this if
you rely on literal interpretation elsewhere.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">The</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">and</span></code></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mkds.nkm.NKM.from_file">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mkds/nkm.html#NKM.from_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mkds.nkm.NKM.from_file" title="Link to this definition">¶</a></dt>
<dd><p>Load an NKM file from disk and parse its sections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – Path to the <cite>.nkm</cite> file. Defaults to DEFAULT_NKM_PATH.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The parsed NKM object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#mkds.nkm.NKM" title="mkds.nkm.NKM">NKM</a></p>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="kcl.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">mkds.kcl module</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../mkds.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">MKDS File Parsing Library</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Blake Moody
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">mkds.nkm module</a><ul>
<li><a class="reference internal" href="#mkds.nkm.Section"><code class="docutils literal notranslate"><span class="pre">Section</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.OBJI"><code class="docutils literal notranslate"><span class="pre">OBJI</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.PATH"><code class="docutils literal notranslate"><span class="pre">PATH</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.POIT"><code class="docutils literal notranslate"><span class="pre">POIT</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.STAG"><code class="docutils literal notranslate"><span class="pre">STAG</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.KTPS"><code class="docutils literal notranslate"><span class="pre">KTPS</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.KTPJ"><code class="docutils literal notranslate"><span class="pre">KTPJ</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.KTP2"><code class="docutils literal notranslate"><span class="pre">KTP2</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.KTPC"><code class="docutils literal notranslate"><span class="pre">KTPC</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.KTPM"><code class="docutils literal notranslate"><span class="pre">KTPM</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.CPOI"><code class="docutils literal notranslate"><span class="pre">CPOI</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.CPAT"><code class="docutils literal notranslate"><span class="pre">CPAT</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.IPOI"><code class="docutils literal notranslate"><span class="pre">IPOI</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.IPAT"><code class="docutils literal notranslate"><span class="pre">IPAT</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.EPOI"><code class="docutils literal notranslate"><span class="pre">EPOI</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.EPAT"><code class="docutils literal notranslate"><span class="pre">EPAT</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.MEPO"><code class="docutils literal notranslate"><span class="pre">MEPO</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.MEPA"><code class="docutils literal notranslate"><span class="pre">MEPA</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.AREA"><code class="docutils literal notranslate"><span class="pre">AREA</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.CAME"><code class="docutils literal notranslate"><span class="pre">CAME</span></code></a></li>
<li><a class="reference internal" href="#mkds.nkm.NKM"><code class="docutils literal notranslate"><span class="pre">NKM</span></code></a><ul>
<li><a class="reference internal" href="#mkds.nkm.NKM.from_file"><code class="docutils literal notranslate"><span class="pre">NKM.from_file()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>